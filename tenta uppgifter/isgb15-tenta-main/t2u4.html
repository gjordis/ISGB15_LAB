<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tentafråga 4</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <table>
        <tr>
            <td data-type="item" data-price="63">Pasta</td>
            <td data-type="item" data-price="69">Ris</td>
            <td data-type="item" data-price="59">Potatis</td>
        </tr>
        <tr>
            <td data-type="ad">KAU.se</td>
            <td data-type="ad">Beställ den bästa maten</td>
            <td data-type="ad">KAU.se</td>
        </tr>
    </table>
    <hr>
    <div id="order">
        <h1>Beställning</h1>
    </div>
    <hr>
    <div id="checkout">
        <a href="https://www.kau.se" id="pay" data-type="pay">Betala</a>
        <p id="status"></p>
    </div>
    <script>
        'use strict';

        window.addEventListener('load', function () { //Kör anonym funktion när sidan laddat in

            document.querySelector('table').addEventListener('click', clickedItem); //Lagt till lyssnare på table-elementet, inväntar klick, vid klick gör funktionsanrop

            //Funktion som körs när vi tryckt på ett föremål
            function clickedItem(e) {

                if (e.target.getAttribute('data-type') === 'item') { //Kontroll av targets attribut, matchar mot item
                    let newDiv = document.createElement('div'); //Skapa nytt div-element
                    let newH4 = document.createElement('h4'); //Skapa ett h4-element
                    let newP = document.createElement('p'); //Skapa ett p-element

                    newH4.textContent = e.target.textContent; //Ändra h4-elementets textContent till target.textContent (Namn på varan)
                    newP.textContent = e.target.getAttribute('data-price') + ' kr'; //Ändra p-elementets textContent till target attributets datapris + lägg till 'kr' på slutet

                    newDiv.appendChild(newH4); //Lägg in h4-elementet i nya div-elementet
                    newDiv.appendChild(newP); //Lägg in p-elementet i nya div-elementet
                    document.querySelector('div[id=order]').appendChild(newDiv); //Lägg in ny div i DOMen efter Div med id=order
                }
            }

            //Anonym funktion som körs när vi trycker på betala, inväntar click händelse
            document.querySelector('div a[id=pay]').addEventListener('click', function (e) {

                e.preventDefault(); //Ta bort defaultbeteende för klick-funktionen
                e.stopPropagation(); // Avbryta att händelsen propageras (bubblar) vidare till förälderns element
                document.querySelector('table').removeEventListener('click', clickedItem); //Ta bort lyssnare på table
                document.querySelector('p[id=status]').textContent = 'Klart!'; //Skriv ut texten 'Klart!' när vi tryckt på betala
            });
        });
    </script>
</body>

</html>